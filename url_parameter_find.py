"""
    author: jlz
    date: 2017-03-30
    what does this script do: iterate over input file( one url one line ), filter by query in url, only output those urls whoes query parameter contains url.
"""
import os
import sys
reload(sys)
sys.setdefaultencoding('utf-8')
import time
import json
import Queue
import traceback
import urlparse
import argparse
from pprint import pprint, pformat

def hash_url( url ):
    this_url = urlparse.urlparse( url )
    this_url_netloc = this_url.netloc
    this_url_query = tuple(urlparse.parse_qs( this_url.query ).keys())

    return ( this_url_netloc, this_url_query )
    
def main():
    with open( sys.argv[1], 'rb' ) as fin:
        lines = fin.readlines()
    to_process_urls = [ line.strip() for line in lines ]

    all_netloc_and_query_set = set()

    for url in to_process_urls:

        if hash_url( url ) not in all_netloc_and_query_set:

            all_netloc_and_query_set.add( hash_url( url ) )

            # query in this url
            q = urlparse.parse_qs( urlparse.urlparse( url ).query ).values()

            # filter
            for value_list in q:
                for value in value_list:
                    if value.startswith( 'http' ):
                    #if value.lower().find( 'file' )!=-1:
                        print url
                        print ''

if __name__ == '__main__':
    main()
