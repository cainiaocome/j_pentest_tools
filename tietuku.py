#!/usr/bin/env python3
# encoding: utf8

# convenient image upload script for myself :)
# usage example: tietuku.py tmp.png

import os
import sys
import time
import traceback
import json
import argparse
import hashlib
import requests
import random
import threading


def main():

    from pprint import pprint
    import pyperclip

    url = 'http://up.imgapi.com/'
    # www.tietuku.com申请一个就可以了，尽量不要用这个吧，我也不知道是不是有频率额度限制之类的
    token = 'd13b47d1235c806bac31f8624fade749c48879dd:1i2LBNV7CU9QCGuFDev6ea9YXNU=:eyJkZWFkbGluZSI6MTQ5NjMxMTgxMSwiYWN0aW9uIjoiZ2V0IiwidWlkIjoiNTk2MDI5IiwiYWlkIjoiMTMxMjQxNyIsImZyb20iOiJmaWxlIn0=' 

    data = {
        'Token': token,
    }
    with open( sys.argv[1], 'rb' ) as fin:
        r = requests.post( url, data=data, files={'file':fin}, timeout=3 )

    r = json.loads( r.text )
    
    pprint( r )
    print( '-'*30 )

    pyperclip.set_clipboard( 'xclip' )
    pyperclip.copy( r['linkurl'] )

    print( '图片地址已经复制到系统粘贴板，直接ctrl+v粘贴即可 :)' )

if __name__ == '__main__':
    main()
